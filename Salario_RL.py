import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import io 
import base64
from sklearn.linear_model import LinearRegression

data = {
    "Años Educacion": [
    10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 
    15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 
    18, 19, 19, 19, 19, 19, 20, 20, 21, 21, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 24, 24, 
    24, 24, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 27, 27, 27, 27, 27, 28, 28, 28, 28, 28, 29, 
    29, 29, 29, 29, 29, 29, 30, 30, 30, 31, 31, 31, 31, 31, 32, 32, 32, 32, 32, 32, 32, 33, 33, 33, 
    33, 33, 33, 33, 33, 34, 34, 34, 34, 35, 35, 36, 36, 36, 36, 36, 37, 37, 37, 37, 37, 37, 37, 37, 
    38, 38, 38, 38, 38, 38, 39, 39, 39, 39, 39, 39, 39, 39, 39, 39, 39, 40, 40, 40, 40, 41, 41, 41, 
    41, 41, 41, 41, 42, 42, 42, 42, 42, 42, 42, 42, 43, 43, 43, 43, 43, 43, 43, 43, 43, 44, 44, 44, 
    45, 45, 45, 45, 46, 46, 46, 46, 46, 46, 47, 47, 47, 47, 47, 47, 47, 48, 48, 50, 50, 50, 50, 50, 
    50, 51, 51, 51, 51, 51, 51, 51, 52, 52, 52, 52, 52, 52, 52, 52, 52, 53, 53, 53, 53, 53, 53, 53, 
    53, 53, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 55, 55, 55, 55, 56, 56, 56, 56, 57, 57, 57, 58, 
    58, 58, 58, 59, 59, 59, 59, 59, 59, 60, 60, 60, 60, 61, 61, 61, 61, 61, 62, 62, 62, 62, 62, 62, 
    63, 63, 63, 63, 63, 63, 63, 63, 64, 64, 64, 64, 65, 65, 65, 65, 65, 65, 65, 65, 65, 66, 66, 66, 
    66, 67, 67, 67, 67, 67, 67, 67, 68, 68, 68, 68, 68, 68, 69, 69, 69, 70, 70, 71, 71, 71, 71, 71, 
    72, 72, 72, 72, 72, 72, 72, 72, 72, 73, 73, 73, 73, 74, 74, 74, 74, 74, 74, 74, 74, 74, 75, 75, 
    75, 75, 75, 75, 75, 75, 76, 76, 76, 76, 76, 77, 77, 77, 78, 79, 79, 79, 79, 80, 80, 80, 80, 80, 
    80, 80, 80, 81, 81, 81, 81, 81, 81, 81, 81, 82, 82, 82, 82, 82, 82, 83, 83, 83, 83, 83, 84, 84, 
    84, 84, 84, 84, 84, 84, 85, 85, 85, 85, 85, 85, 85, 85, 86, 86, 86, 86, 86, 87, 87, 87, 87, 88, 
    88, 88, 88, 88, 88, 88, 89, 89, 89, 89, 90, 90, 91, 91, 91, 91, 91, 92, 92, 92, 92, 93, 93, 93, 
    93, 94, 94, 94, 94, 95, 95, 95, 95, 95, 95, 95, 96, 96, 96, 96, 96, 96, 96, 97, 97, 97, 97, 97, 
    97, 97, 97, 97, 98, 98, 98, 98, 98, 98, 98, 98, 99, 99, 99, 99, 99, 99, 100, 100
    ],

    "Salario Mensual (USD)": [
    135, 138, 129, 147, 144, 136, 139, 140, 144, 143, 138, 155, 148, 153, 163, 154, 156, 147, 160, 163, 
    156, 169, 175, 171, 175, 176, 178, 187, 171, 189, 175, 185, 187, 189, 191, 186, 183, 181, 194, 186, 
    197, 194, 207, 194, 197, 196, 203, 210, 211, 210, 205, 208, 208, 202, 215, 214, 219, 219, 232, 234, 
    242, 239, 232, 228, 242, 236, 246, 239, 244, 243, 248, 247, 255, 252, 260, 259, 263, 262, 264, 259, 
    258, 260, 260, 258, 273, 276, 263, 277, 274, 275, 273, 280, 286, 282, 286, 291, 298, 281, 286, 288, 
    301, 297, 295, 292, 299, 300, 304, 303, 314, 305, 313, 319, 321, 321, 316, 326, 322, 319, 319, 324, 
    333, 324, 333, 333, 336, 328, 339, 338, 342, 349, 349, 353, 351, 355, 353, 358, 351, 358, 359, 366, 
    365, 363, 366, 361, 374, 370, 364, 364, 368, 359, 368, 372, 366, 380, 378, 372, 379, 380, 385, 384, 
    380, 380, 383, 380, 384, 386, 396, 396, 384, 399, 399, 393, 392, 405, 401, 398, 412, 403, 400, 410, 
    406, 409, 420, 412, 421, 408, 415, 413, 415, 419, 411, 423, 424, 429, 430, 418, 443, 432, 436, 433, 
    441, 429, 448, 450, 447, 446, 455, 449, 444, 443, 452, 460, 464, 465, 469, 465, 470, 474, 469, 479, 
    473, 473, 482, 481, 483, 486, 492, 494, 479, 484, 477, 490, 491, 492, 492, 494, 490, 495, 500, 487, 
    497, 495, 509, 499, 497, 500, 509, 506, 503, 508, 515, 503, 499, 507, 509, 506, 513, 518, 518, 526, 
    526, 519, 531, 536, 532, 539, 543, 533, 536, 540, 548, 544, 549, 549, 554, 546, 554, 555, 558, 556, 
    560, 566, 567, 576, 563, 569, 577, 570, 572, 573, 570, 565, 579, 582, 568, 574, 580, 593, 584, 582, 
    599, 585, 596, 589, 590, 593, 594, 593, 604, 596, 603, 598, 608, 615, 606, 610, 615, 618, 623, 605, 
    616, 615, 618, 628, 613, 623, 626, 625, 629, 643, 637, 644, 642, 638, 643, 648, 646, 656, 651, 649, 
    650, 656, 641, 650, 657, 654, 650, 666, 671, 662, 666, 676, 663, 667, 666, 668, 669, 679, 676, 676, 
    679, 679, 679, 687, 679, 695, 678, 688, 676, 683, 694, 692, 697, 689, 703, 723, 714, 713, 719, 715, 
    710, 725, 718, 723, 725, 731, 728, 726, 729, 730, 726, 735, 734, 732, 728, 731, 730, 722, 726, 739, 
    740, 734, 745, 743, 751, 742, 748, 752, 758, 755, 753, 750, 755, 759, 756, 765, 770, 765, 767, 768, 
    763, 762, 764, 762, 770, 766, 777, 769, 774, 780, 788, 788, 775, 783, 786, 791, 796, 794, 782, 792, 
    792, 798, 797, 805, 816, 812, 806, 819, 808, 819, 828, 821, 821, 832, 827, 830, 833, 838, 828, 831, 
    843, 846, 849, 839, 846, 844, 843, 843, 852, 854, 849, 847, 856, 856, 865, 851, 861, 855, 866, 853, 
    869, 862, 861, 856, 865, 875, 867, 867, 872, 864, 870, 878, 877, 870, 885, 873, 867, 878, 881, 889
    ]
}   

df = pd.DataFrame(data)

x = df[["Años Educacion"]]
y = df[["Salario Mensual (USD)"]]

model = LinearRegression()
model.fit(x,y)
def calcularsalario(salario):
    result = model.predict([[salario]])[0]
    return result
    

def generate_plot():
 #Genera un gráfico de regresión lineal y lo convierte en imagen base64
    plt.figure(figsize=(8, 6))
    plt.scatter(df["Años Educacion"], df["Salario Mensual (USD)"], color="pink", label="Datos reales")
    plt.plot(df["Años Educacion"], model.predict(x), color="green", linewidth=2, label="Regresión lineal")
    plt.xlabel("Años Educacion")
    plt.ylabel("Salario Mensual (USD)")
    plt.title("Regresión Lineal: Años de Estudio vs Salario Mensual (USD)")
    plt.legend()

    # Guardar la imagen en memoria
    img = io.BytesIO()
    plt.savefig(img, format="png")
    img.seek(0)
    grafico = base64.b64encode(img.getvalue()).decode()
    plt.close()
    return grafico